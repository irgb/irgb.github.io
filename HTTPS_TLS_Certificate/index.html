<!DOCTYPE html><html lang="en"><head><meta name="google-site-verification" content="8STslQB6oQuQonukDzpOMhY1irA5r0Feoc4VDSXpodg"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>数字签名, 数字证书, 加密, SSL, HTTPS | Irgb</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">数字签名, 数字证书, 加密, SSL, HTTPS</h1><a id="logo" href="/.">Irgb</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/guestbook/"><i class="fa fa-comments"> Guestbook</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">数字签名, 数字证书, 加密, SSL, HTTPS</h1><div class="post-meta">Mar 15, 2017<span> | </span><span class="category"><a href="/categories/web/">web</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Views</span></span></div><a data-disqus-identifier="HTTPS_TLS_Certificate/" href="/HTTPS_TLS_Certificate/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><h1 id="加解密"><a href="#加解密" class="headerlink" title="加解密"></a>加解密</h1><ul>
<li>对称加密算法: DES, 3DES, AES(标准)</li>
<li>非对称加密: RSA, DSA, 分公钥和私钥.<h1 id="摘要算法-Digest"><a href="#摘要算法-Digest" class="headerlink" title="摘要算法(Digest)"></a>摘要算法(Digest)</h1></li>
<li>MD5</li>
<li>SHA1, SHA2(常用)<a href="https://en.wikipedia.org/wiki/Secure_Hash_Algorithm" target="_blank" rel="noopener">参考</a></li>
</ul>
<h1 id="数字签名"><a href="#数字签名" class="headerlink" title="数字签名"></a>数字签名</h1><p>数字签名用于验证发送方的身份, 并保证数据的完整性.</p>
<ol>
<li>发送方对要传输的数据计算摘要</li>
<li>对摘要用私钥加密, 该密文称为签名</li>
<li>接收方收到数据,用同样的摘要算法计算出摘要1, 并用发送方的公钥解密签名得到摘要2, 如果摘要1 == 摘要2, 说明数据确实来自发送方,并且传输过程中数据没有被篡改.<blockquote>
<p>接收方需要有发送方的公钥, 公钥是通过数字证书获得的.<br><a href="http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html" target="_blank" rel="noopener">图文参考</a></p>
</blockquote>
</li>
</ol>
<h1 id="数字证书"><a href="#数字证书" class="headerlink" title="数字证书"></a>数字证书</h1><p>数字证书由证书颁发机构(CA, certificate authority)颁发,可以用于确认证书持有者的身份和分发公钥.<br>数字证书中包含的内容:</p>
<ul>
<li>Subject Name: 证书持有人的信息,国家,地点,域名等</li>
<li>Issuer Name: 证书颁发机构信息</li>
<li>Public Key: 证书持有人的公钥</li>
<li>Signature algorithm : 采用的摘要算法</li>
<li>Valid before/after: 证书有效时间</li>
<li>FingerPrints: 证书的签名, 由颁发机构用自己的私钥加密, 用颁发机构的公钥可以解密签名获得证书的摘要, 如果这个摘要与用户计算出的摘要一致,那么这个证书就是可以信任的.</li>
</ul>
<h1 id="根证书-root-certificate"><a href="#根证书-root-certificate" class="headerlink" title="根证书(root certificate):"></a>根证书(root certificate):</h1><p>证书颁发机构给自己颁发的证书, 内含该机构的公钥, 是信任链的起点. 用户可以使用公钥去验证该机构颁发的其他证书. 根证书通常由操作系统预装.</p>
<h1 id="SSL"><a href="#SSL" class="headerlink" title="SSL"></a>SSL</h1><p>SSL: Secure Sockets Layer, 是介于HTTP和TCP之间的一个可选层. 是一套由非对称加密, 对称加密, 摘要算法构成的加密传输协议. client像server所要公钥并验证, 通信双方协商一个对称加密密钥, 然后双方采用对称加密算法进行加密通信.</p>
<h3 id="握手过程"><a href="#握手过程" class="headerlink" title="握手过程:"></a>握手过程:</h3><p>握手就是互相验证,并协商密钥的过程, 如图.<br><img src="https://i.imgsafe.org/8e54710257.png" alt="握手过程"></p>
<p><strong>交互流程图</strong>:</p>
<p><img src="https://i.imgsafe.org/8e58a55806.png" alt="握手过程"><br><a href="https://www.ibm.com/support/knowledgecenter/SSFKSJ_7.1.0/com.ibm.mq.doc/sy10660_.htm" target="_blank" rel="noopener"><em>图片来源</em></a></p>
<p><strong>WireShark抓包结果</strong>:</p>
<p><img src="https://i.imgsafe.org/8e5bd5fe66.png" alt="握手过程"></p>
<ul>
<li><p>client发送</p>
<ul>
<li><p><strong>ClientHello</strong>,数据结构:</p>
<pre><code>struct {
    ProtocolVersion client_version;// client支持的协议版本,SSL2.0, SSL3.0, SSL3.1 ie TLS1.0,TLS2.0等
    Random random;//32 bytes(4 bytes timestamp + 28 random bytes),用于生成对称密钥
    SessionID session_id;//the client may decide to reuse previously established session.
    CipherSuite cipher_suites&lt;2..2^16-1&gt;;//client可用的加密组合, 如TLS_RSA_WITH_3DES_EDE_CBC_SHA, TLS_RSA_WITH_DES_CBC_SHA
    CompressionMethod compression_methods&lt;1..2^8-1&gt;;//client支持的压缩算法, deflate, gzip等
    Extension extensions&lt;0..2^16-1&gt;;
} ClientHello;
</code></pre></li>
</ul>
</li>
<li><p>server收到请求, 发送</p>
<ul>
<li><p><strong>ServerHello</strong>,数据结构:</p>
<pre><code>struct {
   ProtocolVersion server_version;//
   Random random;//与ClientHello.random一样,但两者必须不同
   SessionID session_id;
   CipherSuite cipher_suite;//Server从ClientHello中选择出的一个cipher suite
   CompressionMethod compression_method;//Server从ClientHello中选择出的一个压缩算法
} ServerHello;
</code></pre></li>
<li><strong>Server Certificate</strong>, 即server的数字证书,其中包含了server的公钥, client将用这个公钥验证server, 并用于下一步中加密premaster secret.</li>
<li><strong>Server Key Exchange</strong>,可选的,client可用来加密下一步中的Client Key Exchange,只有当证书中不包含公钥的时候才需要.如Diffie Hellman密钥交换算法.通常使用RSA公钥算法的时候不需要提供.<a href="https://en.wikipedia.org/wiki/Key_exchange#Public_key_infrastructure" target="_blank" rel="noopener">key-exchange-参考1</a>,<a href="https://technet.microsoft.com/en-us/library/cc962035.aspx" target="_blank" rel="noopener">key-exchange-参考2</a></li>
<li><strong>Client Certificate Request</strong>,可选的,通常的站点不需要验证用户的身份,如google;但银行站点需要验证,如U盾中就包含了client证书,通信过程需要客户与银行互相验证.</li>
<li><strong>Server Hello Done</strong>,抓包结果中并没有这个</li>
</ul>
</li>
<li><p>client获得server证书之后, 验证证书的合法性. 如果证书受信任，浏览器栏里面会显示一个小锁头，否则会给出证书不受信的提示。如果证书受信任，或者是用户接受了不受信的证书，client会再生成一串随机数(用于生成对称密钥, <strong>第三个随机数称为pre-master key</strong>)，计算摘要,并一起用证书中提供的公钥加密,发送给server:</p>
<ul>
<li><strong>Client Certificate</strong>, 可选的,只有收到了server的Client Certificate Request消息后才发送</li>
<li><strong>Certificate Verify</strong>. 在client发送Client Certificate之后发送,发送了一段数据和签名,用于server验证client是否拥有正确的私钥.</li>
<li><strong>Client Key Exchange</strong>, client利用已有的随机数生成一个premaster secret, 用server的公钥加密后发送给server.双方都在本地计算master key,而不是通过网络传输.</li>
<li><strong>Change Cipher Spec</strong>.通知server,Client Finish之后的所有消息都使用刚刚协商好的密钥加密.</li>
<li><strong>Client Finished</strong>. client计算整个会话的摘要, 然后用协商好的密钥加密之后发送给server,这是第一条用协商密钥加密的消息.</li>
</ul>
</li>
<li><p>server接收client发来的数据之后,用自己的私钥将信息解密,取出随机数,并验证摘要是否一致。server利用前面得到的<strong>三个随机数</strong>生成对称密钥(协商密钥).然后向client发送通知:</p>
<ul>
<li><strong>Change Cipher Spec</strong>. 通知client, server将用协商的密钥加密之后的消息.</li>
<li><strong>Server Finished</strong>. server计算整个会话的摘要,用协商密钥加密之后发给client,如果client能解密,并且摘要通过验证,那么握手过程就建立好了.</li>
</ul>
</li>
</ul>
<blockquote>
<p>握手过程中如果有任何错误，都会断开连接.</p>
</blockquote>
<p>参考:</p>
<blockquote>
<p><a href="https://technet.microsoft.com/en-us/library/cc785811(v=ws.10).aspx" target="_blank" rel="noopener">https://technet.microsoft.com/en-us/library/cc785811(v=ws.10).aspx</a><br><a href="http://www.cisco.com/c/en/us/support/docs/security-vpn/secure-socket-layer-ssl/116181-technote-product-00.html" target="_blank" rel="noopener">http://www.cisco.com/c/en/us/support/docs/security-vpn/secure-socket-layer-ssl/116181-technote-product-00.html</a><br><a href="http://tools.ietf.org/html/rfc2246#page-31" target="_blank" rel="noopener">http://tools.ietf.org/html/rfc2246#page-31</a><br><a href="http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html</a><br><a href="http://www.infoq.com/cn/articles/HTTPS-Connection-Jeff-Moser" target="_blank" rel="noopener">http://www.infoq.com/cn/articles/HTTPS-Connection-Jeff-Moser</a><br>ssl握手过程抓包工具wireshark</p>
</blockquote>
<h1 id="TLS-Transport-Layer-Security"><a href="#TLS-Transport-Layer-Security" class="headerlink" title="TLS (Transport Layer Security)"></a>TLS (Transport Layer Security)</h1><p>TLS来源于SSL, 从SSL3.1开始改名为TLS1.0, 所以经常会说SSL/TLS. </p>
<blockquote>
<p>TLS与SSL的区别与联系:<br><a href="http://security.stackexchange.com/questions/5126/whats-the-difference-between-ssl-tls-and-https" target="_blank" rel="noopener">http://security.stackexchange.com/questions/5126/whats-the-difference-between-ssl-tls-and-https</a><br><a href="https://luxsci.com/blog/ssl-versus-tls-whats-the-difference.html" target="_blank" rel="noopener">https://luxsci.com/blog/ssl-versus-tls-whats-the-difference.html</a></p>
</blockquote>
<h1 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h1><p>HTPPS = TCP + SSL/TLS. </p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="https://irgb.github.io/HTTPS_TLS_Certificate/" data-id="cjh695ld900066ipkkufdsd11" class="article-share-link">Share</a><div class="tags"><a href="/tags/TLS/">TLS</a><a href="/tags/HTTPS/">HTTPS</a></div><div class="post-nav"><a href="/开发环境/Linux-环境配置/" class="pre">Linux 常用配置</a><a href="/genetic_algorithm/" class="next">Genetic Algorithm Hello World</a></div><div id="disqus_thread"><script>var disqus_shortname = 'linjapyc';
var disqus_identifier = 'HTTPS_TLS_Certificate/';
var disqus_title = '数字签名, 数字证书, 加密, SSL, HTTPS';
var disqus_url = 'https://irgb.github.io/HTTPS_TLS_Certificate/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//linjapyc.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Google Search"/><input type="hidden" name="sitesearch" value="https://irgb.github.io"/></form></div><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Local Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/C/">C++</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/algorithm/">algorithm</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c/">c++</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/coding/">coding</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/fun/">fun</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/maven/">maven</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tool/">tool</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools/">tools</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a><span class="category-list-count">2</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/genetic/" style="font-size: 15px;">genetic</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/TLS/" style="font-size: 15px;">TLS</a> <a href="/tags/HTTPS/" style="font-size: 15px;">HTTPS</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/github/" style="font-size: 15px;">github</a> <a href="/tags/travis/" style="font-size: 15px;">travis</a> <a href="/tags/leetcode/" style="font-size: 15px;">leetcode</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/websocket/" style="font-size: 15px;">websocket</a> <a href="/tags/c-tools/" style="font-size: 15px;">c++ tools</a> <a href="/tags/c/" style="font-size: 15px;">c++</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/heap/" style="font-size: 15px;">heap</a> <a href="/tags/sort/" style="font-size: 15px;">sort</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/fun/" style="font-size: 15px;">fun</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/graph/" style="font-size: 15px;">graph</a> <a href="/tags/tools/" style="font-size: 15px;">tools</a> <a href="/tags/c-design-pattern-factory-pattern/" style="font-size: 15px;">c++ design-pattern factory-pattern</a> <a href="/tags/c-gcc/" style="font-size: 15px;">c++ gcc</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/algorithm-hash/" style="font-size: 15px;">algorithm hash</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/利用非对称加密传输文件/">利用非对称加密传输文件</a></li><li class="post-list-item"><a class="post-list-link" href="/C++/hash/">Hash</a></li><li class="post-list-item"><a class="post-list-link" href="/如何重写库函数或系统调用/">重写库函数或系统调用</a></li><li class="post-list-item"><a class="post-list-link" href="/C++线程优雅退出/">C++ 线程优雅退出</a></li><li class="post-list-item"><a class="post-list-link" href="/mysql 常用命令/">mysql 常用命令</a></li><li class="post-list-item"><a class="post-list-link" href="/gperftools 安装与使用/">gperftools</a></li><li class="post-list-item"><a class="post-list-link" href="/C++/atomic_vs_lock/">C++ atomic, lock 性能对比</a></li><li class="post-list-item"><a class="post-list-link" href="/德州扑克/">德州扑克（texas poker)</a></li><li class="post-list-item"><a class="post-list-link" href="/C++/ C++工厂模式/">C++ 工厂模式</a></li><li class="post-list-item"><a class="post-list-link" href="/C++/C++代码调试/">C++ 代码调试</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Irgb.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-92562797-1','auto');ga('send','pageview');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>